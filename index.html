<!DOCTYPE html>
<html>
<head>
  <title>Sofá AR Interativo</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
</head>

<body style="margin:0; overflow:hidden;">
  <a-scene embedded arjs="sourceType: webcam;" gesture-detector>

    <a-marker preset="hiro">

      <a-entity
        id="coachModel"
        gltf-model="url(old_couch.glb)"
        scale="0.3 0.3 0.3"
        position="0 0 0"
        gesture-handler
        animation-mixer="clip:*; loop: repeat;">

        <a-animation
          attribute="rotation"
          begin="start-wobble"
          from="0 0 0"
          to="0 20 0"
          dur="500"
          easing="ease-in-out-sine"
          direction="alternate"
          repeat="1">
        </a-animation>

        <a-animation
          attribute="scale"
          begin="mousedown"
          to="0.32 0.32 0.32"
          dur="300"
          easing="ease-in-out-sine">
        </a-animation>

        <a-animation
          attribute="scale"
          begin="mouseup"
          to="0.3 0.3 0.3"
          dur="300"
          easing="ease-in-out-sine">
        </a-animation>

      </a-entity>

      <a-light type="ambient" color="#555"></a-light>
      <a-light type="directional" intensity="1.5" position="2 4 3"></a-light>
    </a-marker>

    <a-entity camera></a-entity>

  </a-scene>

  <script>
    window.onload = function() {
      const coachModel = document.querySelector("#coachModel");

      // Evento de toque rápido (tap)
      coachModel.addEventListener('gesture-tap', function (e) {
        console.log("Toque detectado! Iniciando balanço.");
        // Emite o evento 'start-wobble' que a <a-animation> está ouvindo
        coachModel.emit('start-wobble');
      });
    };
  </script>
</body>
</html>